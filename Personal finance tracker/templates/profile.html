{% extends "base.html" %}
{% block content %}
<h2>User Profile</h2>

<style>
    .profile-pic:hover {
        opacity: 0.8;
        cursor: pointer;
        transition: 0.3s;
    }
</style>

<div class="card mx-auto" style="width: 20rem;">
    <!-- Round image -->
    <img src="{{ url_for('static', filename='profile_pics/' ~ (current_user.profile_pic or 'default.png')) }}"
     class="card-img-top rounded-circle mx-auto d-block mt-3 profile-pic"
     style="width: 150px; height: 150px; object-fit: cover; border: 2px solid #ccc;"
     alt="Profile Picture"
     data-bs-toggle="modal" data-bs-target="#imageModal">


    <div class="card-body">
        <form method="POST" enctype="multipart/form-data">
            <div class="mb-3">
                <label>Username</label>
                <input type="text" class="form-control" name="username" value="{{ current_user.username }}" required>
            </div>
            <div class="mb-3">
                <label>Email</label>
                <input type="email" class="form-control" name="email" value="{{ current_user.email }}" required>
            </div>
            <div class="mb-3">
                <label>Minimum Balance (â‚¹)</label>
                <input type="number" step="0.01" class="form-control" name="min_balance" value="{{ current_user.min_balance }}" required>
            </div>
            <div class="mb-3">
                <label>Profile Picture</label>
                <input type="file" class="form-control" name="profile_pic">
            </div>
            <button type="submit" class="btn btn-primary">Update Profile</button>
        </form>

        <!-- Logout button -->
        <button class="btn btn-danger mt-3 w-100" data-bs-toggle="modal" data-bs-target="#logoutModal">
            Logout
        </button>
    </div>
</div>

<!-- Modal for image preview -->
<div class="modal fade" id="imageModal" tabindex="-1" aria-labelledby="imageModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title" id="imageModalLabel">Profile Picture</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body text-center">
            <img src="{{ url_for('static', filename='profile_pics/' ~ current_user.profile_pic) }}"
                 style="max-width: 100%; border-radius: 50%;" alt="Profile Picture">
        </div>
    </div>
  </div>
</div>

<!-- Logout confirmation modal -->
<div class="modal fade" id="logoutModal" tabindex="-1" aria-labelledby="logoutModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title" id="logoutModalLabel">Confirm Logout</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
            Are you sure you want to logout?
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">No</button>
            <a href="{{ url_for('logout') }}" class="btn btn-danger">Yes</a>
        </div>
    </div>
  </div>
</div>
{% endblock %}
